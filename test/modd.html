<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mood Pie Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <h2>Mood Pie Chart</h2>
    <button onclick="logMood('Happy')">😊 Happy</button>
    <button onclick="logMood('Sad')">😔 Sad</button>
    <button onclick="logMood('Angry')">😠 Angry</button>

    <canvas id="moodChart" width="300" height="300"></canvas>

    <h3>Percentages</h3>
    <div id="percentages"></div>

    <script>
      // 1️⃣ Load saved moods from localStorage OR default to 0s
      let moods = JSON.parse(localStorage.getItem("moods")) || {
        Happy: 0,
        Sad: 0,
        Angry: 0,
      };

      const ctx = document.getElementById("moodChart").getContext("2d");
      const chart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: Object.keys(moods),
          datasets: [
            {
              data: Object.values(moods),
              backgroundColor: ["#FFEB3B", "#2196F3", "#F44336"],
            },
          ],
        },
      });

      // function to update chart + percentages + save
      function logMood(mood) {
        moods[mood]++; // add 1 to selected mood
        chart.data.datasets[0].data = Object.values(moods);
        chart.update();

        // update percentages
        updatePercentages();

        // 2️⃣ Save moods to localStorage
        localStorage.setItem("moods", JSON.stringify(moods));
      }

      // helper function to show percentages
      function updatePercentages() {
        const total = Object.values(moods).reduce((a, b) => a + b, 0); //6
        let html = "";
        for (let [key, val] of Object.entries(moods)) {
          const pct = total ? ((val / total) * 100).toFixed(1) : 0; //percetage
          html += `<p>${key}: ${val} (${pct}%)</p>`;
        }
        document.getElementById("percentages").innerHTML = html;
      }

      // 3️⃣ Show percentages right away when page loads
      updatePercentages();
    </script>
  </body>
</html>
