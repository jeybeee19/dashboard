<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mood Overview Pie Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, sans-serif;
      }
      body {
        margin: 0;
        padding: 24px;
        background: #0f172a;
        color: #e2e8f0;
      }
      .wrap {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        font-size: 1.4rem;
        margin: 0 0 12px;
      }
      .sub {
        opacity: 0.8;
        margin-bottom: 16px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin: 14px 0 20px;
      }
      button {
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid #334155;
        background: #111827;
        color: #e2e8f0;
        cursor: pointer;
      }
      button:hover {
        background: #1f2937;
      }
      .pill {
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
      .row {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
      }
      .card {
        background: #0b1220;
        border: 1px solid #1f2937;
        border-radius: 16px;
        padding: 16px;
      }
      .muted {
        opacity: 0.75;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Mood Overview Pie Chart</h1>
      <p class="sub">
        Tap a mood to log it. The pie updates instantly. (Data is saved in your
        browser.)
      </p>

      <div class="grid" id="buttons"></div>

      <div class="row">
        <div class="card" style="flex: 1 1 380px; min-width: 320px">
          <canvas
            id="moodChart"
            width="400"
            height="400"
            aria-label="Mood pie chart"
            role="img"
          ></canvas>
        </div>
        <div class="card" style="flex: 1 1 260px; min-width: 240px">
          <h3 style="margin-top: 0">Totals</h3>
          <div id="totals"></div>
          <hr style="border-color: #243244; opacity: 0.5" />
          <div class="row">
            <button id="resetBtn" title="Clear all counts">Reset</button>
            <button id="undoBtn" title="Undo last log">Undo</button>
          </div>
          <p class="muted" style="margin-top: 10px; font-size: 0.9rem">
            Tip: Use the <kbd>1-6</kbd> keys to log moods quickly.
          </p>
        </div>
      </div>
    </div>

    <script>
      // --- Config ---
      const MOODS = [
        { key: "Happy", emoji: "ðŸ˜Š" },
        { key: "Sad", emoji: "ðŸ˜”" },
        { key: "Angry", emoji: "ðŸ˜ " },
        { key: "Calm", emoji: "ðŸ˜Œ" },
        { key: "Anxious", emoji: "ðŸ˜¬" },
        { key: "Excited", emoji: "ðŸ¤©" },
      ];

      const STORAGE_KEY = "moodCounts.v1";
      const HISTORY_KEY = "moodHistory.v1"; // for Undo

      // --- State helpers ---
      function loadCounts() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          const obj = raw ? JSON.parse(raw) : null;
          const def = Object.fromEntries(MOODS.map((m) => [m.key, 0]));
          return { ...def, ...(obj || {}) };
        } catch {
          return Object.fromEntries(MOODS.map((m) => [m.key, 0]));
        }
      }
      function saveCounts(counts) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(counts));
      }
      function pushHistory(mood) {
        const hist = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");
        hist.push({ mood, t: Date.now() });
        localStorage.setItem(HISTORY_KEY, JSON.stringify(hist));
      }
      function popHistory() {
        const hist = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");
        const last = hist.pop();
        localStorage.setItem(HISTORY_KEY, JSON.stringify(hist));
        return last;
      }

      // --- UI: Buttons ---
      const btnWrap = document.getElementById("buttons");
      const totalsBox = document.getElementById("totals");
      MOODS.forEach((m, i) => {
        const btn = document.createElement("button");
        btn.className = "pill";
        btn.innerHTML = `${m.emoji} ${m.key} <span class="muted">(key ${
          i + 1
        })</span>`;
        btn.addEventListener("click", () => logMood(m.key));
        btnWrap.appendChild(btn);
      });

      // Keyboard shortcuts 1..6
      window.addEventListener("keydown", (e) => {
        const idx = parseInt(e.key, 10) - 1;
        if (!Number.isNaN(idx) && MOODS[idx]) logMood(MOODS[idx].key);
      });

      // --- Chart ---
      const ctx = document.getElementById("moodChart").getContext("2d");
      let counts = loadCounts();

      const chart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: MOODS.map((m) => `${m.emoji} ${m.key}`),
          datasets: [
            {
              label: "Mood Logs",
              data: MOODS.map((m) => counts[m.key]),
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" },
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  const total = totalCount(counts);
                  const val = ctx.parsed || 0;
                  const pct = total ? ((val / total) * 100).toFixed(1) : 0;
                  return `${ctx.label}: ${val} (${pct}%)`;
                },
              },
            },
          },
        },
      });

      function totalCount(c) {
        return Object.values(c).reduce((a, b) => a + b, 0);
      }

      function refreshUI() {
        // Update chart data
        chart.data.datasets[0].data = MOODS.map((m) => counts[m.key]);
        chart.update();

        // Totals list
        const total = totalCount(counts);
        const items = MOODS.map((m) => {
          const val = counts[m.key];
          const pct = total ? ((val / total) * 100).toFixed(1) : 0;
          return `<div class="row" style="justify-content:space-between"><span>${m.emoji} ${m.key}</span><strong>${val} â€¢ ${pct}%</strong></div>`;
        }).join("");
        totalsBox.innerHTML =
          items +
          `<div style="margin-top:8px" class="muted">Overall logs: <strong>${total}</strong></div>`;
      }

      function logMood(name) {
        counts[name] = (counts[name] || 0) + 1;
        saveCounts(counts);
        pushHistory(name);
        refreshUI();
      }

      // Reset & Undo
      document.getElementById("resetBtn").addEventListener("click", () => {
        counts = Object.fromEntries(MOODS.map((m) => [m.key, 0]));
        saveCounts(counts);
        localStorage.setItem(HISTORY_KEY, "[]");
        refreshUI();
      });

      document.getElementById("undoBtn").addEventListener("click", () => {
        const last = popHistory();
        if (last && counts[last.mood] > 0) {
          counts[last.mood] -= 1;
          saveCounts(counts);
          refreshUI();
        }
      });

      // First render
      refreshUI();
    </script>
  </body>
</html>
